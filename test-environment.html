<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environment Detection Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .test-result {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        .error {
            border-left-color: #f44336;
        }
        .warning {
            border-left-color: #ff9800;
        }
        code {
            background: rgba(0,0,0,0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Environment Detection Test</h1>
        <p>This test helps verify if the game correctly detects the environment and uses the appropriate AI mode.</p>
        
        <div class="test-result" id="hostname-test">
            <strong>üåê Current Hostname:</strong> <code id="hostname"></code>
        </div>
        
        <div class="test-result" id="protocol-test">
            <strong>üîí Current Protocol:</strong> <code id="protocol"></code>
        </div>
        
        <div class="test-result" id="local-detection">
            <strong>üè† Local Development Detection:</strong> <span id="is-local"></span>
        </div>
        
        <div class="test-result" id="expected-behavior">
            <strong>üìã Expected Behavior:</strong> <span id="behavior"></span>
        </div>
        
        <div class="test-result" id="ai-test">
            <strong>ü§ñ AI Mode Test:</strong> <span id="ai-mode">Testing...</span>
        </div>
        
        <button onclick="testAIConnection()" style="
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        ">
            üîÑ Test AI Connection
        </button>
        
        <div id="ai-result" style="margin-top: 20px;"></div>
    </div>

    <script>
        // Environment detection logic (same as in main.js)
        const IS_LOCAL_DEV = window.location.hostname === 'localhost' || 
                            window.location.hostname === '127.0.0.1' ||
                            window.location.protocol === 'file:';
        
        const IS_ORIGINALLY_LOCAL = window.location.hostname === 'localhost' || 
                                   window.location.hostname === '127.0.0.1' ||
                                   window.location.protocol === 'file:';

        // Update page with current environment info
        document.addEventListener('DOMContentLoaded', function() {
            // Display current environment
            document.getElementById('hostname').textContent = window.location.hostname;
            document.getElementById('protocol').textContent = window.location.protocol;
            
            // Local detection result
            const isLocalEl = document.getElementById('is-local');
            const localDetectionEl = document.getElementById('local-detection');
            
            if (IS_LOCAL_DEV) {
                isLocalEl.innerHTML = '<code>true</code> - Local environment detected';
                localDetectionEl.classList.add('warning');
            } else {
                isLocalEl.innerHTML = '<code>false</code> - Production environment detected';
                localDetectionEl.classList.remove('warning');
            }
            
            // Expected behavior
            const behaviorEl = document.getElementById('behavior');
            const expectedEl = document.getElementById('expected-behavior');
            
            if (IS_LOCAL_DEV) {
                behaviorEl.innerHTML = 'Should use <strong>Mock AI responses</strong> for local testing';
                expectedEl.classList.add('warning');
            } else {
                behaviorEl.innerHTML = 'Should use <strong>Real AI service</strong> (OpenRouter API)';
                expectedEl.classList.remove('warning');
            }
        });

        // Test AI connection
        async function testAIConnection() {
            const resultDiv = document.getElementById('ai-result');
            const aiModeEl = document.getElementById('ai-mode');
            
            aiModeEl.textContent = 'Testing AI connection...';
            resultDiv.innerHTML = '<div style="color: #ffa726;">üîÑ Testing AI connection...</div>';
            
            try {
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer 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',
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.origin,
                        'X-Title': 'Translate Blitz Pro'
                    },
                    body: JSON.stringify({
                        model: 'meta-llama/llama-3.3-70b-instruct',
                        messages: [
                            {
                                role: 'user',
                                content: 'Test connection: respond with just "OK"'
                            }
                        ],
                        max_tokens: 10,
                        temperature: 0.1
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    aiModeEl.innerHTML = '<span style="color: #4CAF50;">‚úÖ Real AI Connected</span>';
                    resultDiv.innerHTML = `
                        <div style="color: #4CAF50; margin-top: 15px;">
                            <strong>‚úÖ AI Connection Successful!</strong><br>
                            Response: ${data.choices?.[0]?.message?.content || 'Success'}<br>
                            <small>Using OpenRouter API with Meta Llama 3.3 70B</small>
                        </div>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error('AI Connection Error:', error);
                
                if (IS_LOCAL_DEV) {
                    aiModeEl.innerHTML = '<span style="color: #ff9800;">‚ö†Ô∏è Mock Mode (Expected)</span>';
                    resultDiv.innerHTML = `
                        <div style="color: #ff9800; margin-top: 15px;">
                            <strong>‚ö†Ô∏è Using Mock Mode (Expected for Local)</strong><br>
                            Error: ${error.message}<br>
                            <small>This is normal when running locally due to CORS restrictions.</small>
                        </div>
                    `;
                } else {
                    aiModeEl.innerHTML = '<span style="color: #f44336;">‚ùå AI Connection Failed</span>';
                    resultDiv.innerHTML = `
                        <div style="color: #f44336; margin-top: 15px;">
                            <strong>‚ùå AI Connection Failed in Production</strong><br>
                            Error: ${error.message}<br>
                            <small>This should not happen in production. Check API key and service status.</small>
                        </div>
                    `;
                }
            }
        }

        // Auto-test on load
        setTimeout(testAIConnection, 1000);
    </script>
</body>
</html>
